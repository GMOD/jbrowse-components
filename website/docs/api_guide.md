---
id: api_guide
title: API
toplevel: true
---

import Figure from './figure'

This guide will cover the API level documentation for methods and tools
useful to developers looking to enhance JBrowse or write plugins.

## MenuItems objects

You can add menus or add items to existing menus in several places.

In these different places, a `MenuItem` object defines the menu item's text,
icon, action, and other attributes.

Types of `MenuItem`s:

- **Normal**: a standard menu item that performs an action when clicked
- **Checkbox**: a menu item that has a checkbox
- **Radio**: a menu item that has a radio button icon
- **Divider**: a horizontal line (not clickable) that can be used to visually
  divide menus
- **SubHeader**: text (not clickable) that can be used to visually label a
  section of a menu
- **SubMenu**: contains menu items, for making nested menus

| Name     | Description                                                                                                                                                                                              |
| -------- | -------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| type     | Options are 'normal', 'radio', 'checkbox', 'subMenu', 'subHeader', or 'divider'. If not provided, defaults to 'normal', unless a `subMenu` attribute is present, in which case it defaults to 'subMenu'. |
| label    | The text for the menu item. Not applicable to 'divider', required for all others.                                                                                                                        |
| subLabel | Additional descriptive text for the menu item. Not applicable to 'divider' or 'subHeader', optional for all others.                                                                                      |
| icon     | An icon for the menu item. Must be compatible with Material-UI's [Icons](https://material-ui.com/components/icons/). Not applicable to 'divider' or 'subHeader', optional for all others.                |
| disabled | Whether or not the menu item is disabled (meaning grayed out and not clickable). Not applicable to 'divider' or 'subHeader', optional for all others.                                                    |
| checked  | Whether or not the checkbox or radio button are selected. Only applicable to 'radio' and 'checkbox'                                                                                                      |
| onClick  | Callback of action to perform on click. Function signature is `(session) => undefined`. Required for 'normal', 'radio', and 'checkbox', not applicable to any others.                                    |
| subMenu  | An array of menu items. Applicable only to 'subMenu'.                                                                                                                                                    |

As an example, the here is an array of MenuItems and the resulting menu:

```js
;[
  {
    label: 'Normal menu item',
    icon: AddIcon,
    onClick: () => {},
  },
  {
    label: 'Normal',
    subLabel: 'with subLabel',
    icon: AddIcon,
    onClick: () => {},
  },
  {
    label: 'Disabled menu item',
    disabled: true,
    icon: AddIcon,
    onClick: () => {},
  },
  {
    type: 'radio',
    label: 'Radio checked',
    checked: true,
    onClick: () => {},
  },
  {
    type: 'radio',
    label: 'Radio unchecked',
    checked: false,
    onClick: () => {},
  },
  {
    type: 'checkbox',
    label: 'Checkbox checked',
    checked: true,
    onClick: () => {},
  },
  {
    type: 'checkbox',
    label: 'Checkbox unchecked',
    checked: false,
    onClick: () => {},
  },
  { type: 'divider' },
  { type: 'subHeader', label: 'This is a subHeader' },
  {
    label: 'SubMenu',
    subMenu: [
      {
        label: 'SubMenu item one',
        onClick: () => {},
      },
      {
        label: 'SubMenu item two',
        onClick: () => {},
      },
    ],
  },
]
```

<Figure src="/img/menu_demo.png" caption="This screenshot shows all the various track menu options, generated by the code listing"/>

## rootModel Menu API

Users can customize the top-level menu items using these functions that are
available on the rootModel:

#### `appendMenu`

Add a top-level menu

##### Parameters

| Name     | Description                 |
| -------- | --------------------------- |
| menuName | Name of the menu to insert. |

##### Return Value

The new length of the top-level menus array

#### `insertMenu`

Insert a top-level menu

##### Parameters

| Name     | Description                                                                                                                                 |
| -------- | ------------------------------------------------------------------------------------------------------------------------------------------- |
| menuName | Name of the menu to insert.                                                                                                                 |
| position | Position to insert menu. If negative, counts from the end, e.g. `insertMenu('My Menu', -1)` will insert the menu as the second-to-last one. |

##### Return Value

The new length of the top-level menus array

#### `appendToMenu`

Add a menu item to a top-level menu

##### Parameters

| Name     | Description                              |
| -------- | ---------------------------------------- |
| menuName | Name of the top-level menu to append to. |
| menuItem | Menu item to append.                     |

##### Return Value

The new length of the menu

#### `insertInMenu`

Insert a menu item into a top-level menu

##### Parameters

| Name     | Description                                                                                                                                      |
| -------- | ------------------------------------------------------------------------------------------------------------------------------------------------ |
| menuName | Name of the top-level menu to insert into.                                                                                                       |
| menuItem | Menu item to insert.                                                                                                                             |
| position | Position to insert menu item. If negative, counts from the end, e.g. `insertMenu('My Menu', -1)` will insert the menu as the second-to-last one. |

##### Return Value

The new length of the menu

#### `appendToSubMenu`

Add a menu item to a sub-menu

##### Parameters

| Name     | Description                                                                                   |
| -------- | --------------------------------------------------------------------------------------------- |
| menuPath | Path to the sub-menu to add to, starting with the top-level menu (e.g. `['File', 'Insert']`). |
| menuItem | Menu item to append.                                                                          |

##### Return value

The new length of the sub-menu

#### `insertInSubMenu`

Insert a menu item into a sub-menu

##### Parameters

| Name     | Description                                                                                                                                      |
| -------- | ------------------------------------------------------------------------------------------------------------------------------------------------ |
| menuPath | Path to the sub-menu to add to, starting with the top-level menu (e.g. `['File', 'Insert']`).                                                    |
| menuItem | Menu item to insert.                                                                                                                             |
| position | Position to insert menu item. If negative, counts from the end, e.g. `insertMenu('My Menu', -1)` will insert the menu as the second-to-last one. |

##### Return value

The new length of the sub-menu

## Extension points

In the core codebase, we have the concept of extension points that users can
call or add to.

The API is

```js
pluginManager.evaluateExtensionPoint(extensionPointName, args)
```

There is also an async method:

```js
pluginManager.evaluateAsyncExtensionPoint(extensionPointName, args)
```

Users can additionally add to extension points, so that when they are evaluated,
it runs a chain of callbacks that are registered to that extension point:

```js
pluginManager.addToExtensionPoint(extensionPointName, callback => newArgs)
```

Here are the extension points in the core codebase:

### Core-extendPluggableElement

(sync) used to add extra functionality to existing state tree models, for
example, extra right-click context menus

### Core-guessAdapterForLocation

(sync) used to infer an adapter type given a location type from the "Add track"
workflow

### Core-guessTrackTypeForLocation

(sync) used to infer a track type given a location type from the "Add track
workflow"

### TrackSelector-multiTrackMenuItems

(sync) used to add new menu items to the "shopping cart" in the header of the
hierarchical track menu when tracks are added to the selection

### LaunchView-LinearGenomeView

(async) launches a linear genome view given parameters

- session:AbstractSessionModel - instance of the session which you can call
  actions on
- assembly:string - assembly name
- loc:string - a locstring
- tracks:string[] - array of trackIds

### LaunchView-CircularView

- session:AbstractSessionModel - instance of the session which you can call
  actions on
- assembly:string - assembly name
- tracks:string[] - array of trackIds

### Extension point footnote

Users that want to add further extension points can do so. The naming system,
"Core-" just refers to the fact that these extension points are from our core
codebase. Plugin developers may choose their own prefix to avoid collisions.

## URL Params

JBrowse Web features the ability to automatically provide URL parameters to
setup a session. This functionality can be used by developers to programatically generate sharable URLs.

:::note
The embedded components like `@jbrowse/react-linear-genome-view` make
no assumptions on how URL params are used, so that would have to be implemented by
the consumer of the library.
:::

### Simple API for linear genome view

We provide a simplified URL format specifically designed for launching a single
linear genome view.

Example:

`http://host/jbrowse2/?config=test_data/config.json&loc=chr1:6000-7000&assembly=hg19&tracks=gene_track,vcf_track`

Here are the query params used here:

#### ?config=

Example:

`?config=test_data/volvox/config.json`

A path to a JBrowse 2 config file, relative to the current folder on the disk.
Note that this just uses client side fetch to read the file, not server side
file reads. If ?config= is not specified, it looks for a file named config.json
e.g. http://host/jbrowse2/config.json which is what the @jbrowse/cli tool sets
up by default.

#### &assembly=

Example:

`&assembly=hg19`

The &assembly parameter refers to an assembly's "name" field one of the
"assemblies" array in the from the config.json. This is only used for launching
a single linear genome view.

#### &loc=

Example:

`&loc=chr1:6000-7000`

This performs a navigation to this region on load, which can be specified using
the syntax. This is only used for launching a single linear genome view.

Example strings:

```
chr1:6000-7000 // using - notation for range
chr1:6000..7000 // using .. notation for range
chr1:7000 // centered on this position
```

:::note
Navigating via a text search query e.g. supply &loc=gene_name is not yet
supported.
:::

#### &tracks=

Example:

`&tracks=gene_track,vcf_track`

This is a comma separated list of trackIds. You can see your trackId's in the
config.json. Note, you can also refer to a trackId added by &sessionTracks=
here. This is only used for launching a single linear genome view.

### More URL parameters

#### &sessionTracks=

If you want to dynamically add a track to the session, you can do so with
`&sessionTracks=`.

You can also use this method to add a `FromConfigAdapter` track, which let's you
specify features in JSON format, so you can e.g. add BLAST hits via the URL bar.

Example:

```
https://jbrowse.org/code/jb2/main/?config=test_data/volvox/config.json&loc=ctgA:1-800&assembly=volvox&tracks=gff3tabix_genes,volvox_filtered_vcf,volvox_microarray,volvox_cram,url_track&sessionTracks=[{"type":"FeatureTrack","trackId":"url_track","name":"URL track","assemblyNames":["volvox"],"adapter":{"type":"FromConfigAdapter","features":[{"uniqueId":"one","refName":"ctgA","start":100,"end":200,"name":"Boris"}]}}]
```

[Live link](https://jbrowse.org/code/jb2/main/?config=test_data/volvox/config.json&loc=ctgA:1-800&assembly=volvox&tracks=gff3tabix_genes,volvox_filtered_vcf,volvox_microarray,volvox_cram,url_track&sessionTracks=[{"type":"FeatureTrack","trackId":"url_track","name":"URL%20track","assemblyNames":["volvox"],"adapter":{"type":"FromConfigAdapter","features":[{"uniqueId":"one","refName":"ctgA","start":100,"end":200,"name":"Boris"}]}}])

This creates a track dynamically that has a single feature at `chr1:100-200`.

The data to supply to `&sessionTracks=` is an array of track configs, and in the
above URL, looks like this when pretty-printed.

```json
[
  {
    "type": "FeatureTrack",
    "trackId": "url_track",
    "name": "URL track",
    "assemblyNames": ["volvox"],
    "adapter": {
      "type": "FromConfigAdapter",
      "features": [
        {
          "uniqueId": "one",
          "refName": "ctgA",
          "start": 190,
          "end": 191,
          "name": "Boris"
        }
      ]
    }
  }
]
```

#### &session=

The session parameter, e.g. &session= has a number of different "input formats."

# Local sessions

The local sessions look like this:

https://host/jbrowse2/?session=local-Fjphq8kjY

By default, after a session is loaded, it is stored into localStorage, and then
the URL bar uses the ?session=local- format to reflect the key of the
localStorage entry.

##### Shared sessions

If you click the "Share button" in the header bar, it will generate a
"shareable link" that you can give to other users, like so:

https://host/jbrowse2/?session=share-HShsEcnq3i&password=nYzTU

See [this FAQ entry for more info about how shared sessions work](/docs/faq#how-does-the-session-sharing-work-with-shortened-urls-work-in-jbrowse-web)

##### Session spec

Another useful session URL is called a "session spec" or "session
specification". This provides a way to launch multiple views at once, including
view types other than the linear genome view.

###### Linear Genome View

```
https://jbrowse.org/code/jb2/main/?config=test_data/volvox/config.json&session=spec-{"views":[{"assembly":"volvox","loc":"ctgA:1-5100","type": "LinearGenomeView","tracks":["gff3tabix_genes","volvox_filtered_vcf","volvox_microarray","volvox_cram"]}]}
```

[Live link](https://jbrowse.org/code/jb2/main/?config=test_data/volvox/config.json&session=spec-{"views":[{"assembly":"volvox","loc":"ctgA:1-5100","type":"LinearGenomeView","tracks":["gff3tabix_genes","volvox_filtered_vcf","volvox_microarray","volvox_cram"]}]})

Expanded:

```json
{
  "views": [
    {
      "assembly": "volvox",
      "loc": "ctgA:1-5100",
      "type": "LinearGenomeView",
      "tracks": [
        "gff3tabix_genes",
        "volvox_filtered_vcf",
        "volvox_microarray",
        "volvox_cram"
      ]
    }
  ]
}
```

As you can see, you can supply an array of views (so you can open multiple
views at once) and can specify the loc, tracks, assembly, and view type, or
other view specific parameters (different view types may accept different
params, e.g. dotplot has two assemblies).

###### Circular view

Here is a session spec for a Circular View:

```
https://jbrowse.org/code/jb2/main/?config=test_data/volvox/config.json&session=spec-{"views":[{"assembly":"volvox","loc":"ctgA:1-5100","type": "CircularView","tracks":["volvox_sv_test"]}]}
```

[Live link](https://jbrowse.org/code/jb2/main/?config=test_data/volvox/config.json&session=spec-{"views":[{"assembly":"volvox","loc":"ctgA:1-5100","type":"CircularView","tracks":["volvox_sv_test"]}]})

Expanded:

```json
{
  "views": [
    {
      "assembly": "volvox",
      "loc": "ctgA:1-5100",
      "type": "CircularView",
      "tracks": ["volvox_sv_test"]
    }
  ]
}
```

###### Dotplot view

```
https://jbrowse.org/code/jb2/main/?config=test_data/volvox/config_main_thread.json&session=spec-%7B"views":%5B%7B"type":"DotplotView","views":%5B%7B"assembly":"volvox"%7D,%7B"assembly":"volvox"%7D%5D,"tracks":%5B"volvox_fake_synteny"%5D%7D%5D%7D
```

[Live link](https://jbrowse.org/code/jb2/main/?config=test_data/volvox/config_main_thread.json&session=spec-%7B"views":%5B%7B"type":"DotplotView","views":%5B%7B"assembly":"volvox"%7D,%7B"assembly":"volvox"%7D%5D,"tracks":%5B"volvox_fake_synteny"%5D%7D%5D%7D)

Expanded:

```json
{
  "views": [
    {
      "type": "DotplotView",
      "views": [{ "assembly": "volvox" }, { "assembly": "volvox" }],
      "tracks": ["volvox_fake_synteny"]
    }
  ]
}
```

:::note
This dotplot session spec doesn't have the ability to navigate to
specific regions on the assembly yet, it just navigates to a whole genome
overview.
:::

###### Spreadsheet view

```
https://jbrowse.org/code/jb2/main/?config=test_data/volvox/config.json&session=spec-%7B%22views%22:%5B%7B%22type%22:%22SpreadsheetView%22,%20%22uri%22:%22test_data/volvox/volvox.filtered.vcf.gz%22,%22assembly%22:%22volvox%22%7D%5D%7D
```

[Live link](https://jbrowse.org/code/jb2/main/?config=test_data/volvox/config.json&session=spec-%7B%22views%22:%5B%7B%22type%22:%22SpreadsheetView%22,%20%22uri%22:%22test_data/volvox/volvox.filtered.vcf.gz%22,%22assembly%22:%22volvox%22%7D%5D%7D)

Expanded:

```json
{
  "views": [
    {
      "type": "SpreadsheetView",
      "uri": "test_data/volvox/volvox.filtered.vcf.gz",
      "assembly": "volvox"
    }
  ]
}
```

###### SV inspector

```
https://jbrowse.org/code/jb2/main/?config=test_data/volvox/config.json&session=spec-%7B"views":%5B%7B"type":"SvInspectorView","uri":"test_data/volvox/volvox.dup.vcf.gz","assembly":"volvox"%7D%5D%7D
```

[Live link](https://jbrowse.org/code/jb2/main/?config=test_data/volvox/config.json&session=spec-%7B%22views%22:%5B%7B%22type%22:%22SvInspectorView%22,%20%22uri%22:%22test_data/volvox/volvox.dup.vcf.gz%22,%22assembly%22:%22volvox%22%7D%5D%7D)

Expanded:

```json
{
  views: [
    {
      type: "SvInspectorView",
      uri: "test_data/volvox/volvox.dup.vcf.gz",
      assembly: "volvox",
    },
  ],
};
```

###### Linear synteny view

```
https://jbrowse.org/code/jb2/main/?config=test_data%2Fvolvox%2Fconfig.json&session=spec-{"views":[{"type":"LinearSyntenyView","tracks":["volvox_fake_synteny"],"views":[{"loc":"ctgA:1-100","assembly":"volvox"},{"loc":"ctgA:300-400","assembly":"volvox"}]}]}
```

[Live link](https://jbrowse.org/code/jb2/main/?config=test_data%2Fvolvox%2Fconfig.json&session=spec-{"views":[{"type":"LinearSyntenyView","tracks":["volvox_fake_synteny"],"views":[{"loc":"ctgA:1-100","assembly":"volvox"},{"loc":"ctgA:300-400","assembly":"volvox"}]}]})

Expanded:

```json
{
  "views": [
    {
      "type": "LinearSyntenyView",
      "tracks": ["volvox_fake_synteny"],
      "views": [
        { "loc": "ctgA:1-100", "assembly": "volvox" },
        { "loc": "ctgA:300-400", "assembly": "volvox" }
      ]
    }
  ]
}
```

##### JSON sessions

Similar to encoded sessions, but more readable, JSON session let you specify
the input a JSON snapshot of a session session. This is slightly different from
a session spec, which has extra logic that loads the session. JSON sessions are
literal session snapshots, like those that might come from the "Export
session..." process.

Example:

```
&session=json-{"session":{"id":"xSHu7qGJN","name":"test","sessionPlugins":[{"url":"https://unpkg.com/jbrowse-plugin-msaview/dist/jbrowse-plugin-msaview.umd.production.min.js"}]}}
```

This loads a session with an extra plugin loaded.

##### Encoded sessions

This is similar to JSON sessions but uses a URL encoding (base64+gzip).

Example:

```
https://jbrowse.org/code/jb2/v1.5.9/?session=encoded-eJyNU2FzmkAQ_SvOfaaNIKDyLbFN0xlrTWRqnU4mc8ACm8BB7k6NdfjvXcCiZpq23-Dt2923u-_2DCPmsevHMn0ePT2umMEEz4GgGWx7C1AKC9EzzQv7wupbpkGfntX3HKt3-YW4OZcJCub1DRZJvgW5xEinzBuMbINtELaKeT_2bY98E0ym_PvdR8rTu7LuMUUBXH4CUeTwjdgUKeJYgZ6_MM-yLWtsGiwo5yBrwBkO3w9dx3b7I3fsuI5FTVGVGd9BdAcJCW27SYhn7QxDKqg0l7pRCIJkmM7YHIxcd2AQbwNSAYExzxQYjCsFeZDtDtlpYo5ZdU9qJQ-fTiZxxrPVYGrf-sdJroHrtQS_ZhIaFiLGZC25JlUUFmGAD0kcPzQ1O90nNQe72dU0eC716vV6rrjC8EObQLEUMElpINu0_tHn3R_yq_t6oBQjuAEegexmP0JfaSv16bpQM_4CMgh1If1WWooguQxTDHnGDpQpDyCjkVhBFTJeliiS-gBpsZ2A0CBrPV3VBt7pIuAiUgvQumZ7Wq6hVrjFKAFNxfZnrfxTKXWw2d3bjG6VN29Rlk2j5mQZaW7ssK8MFmNGin14oVUz1pr5zMQVkXiocQPL_9L6l1jVHFLQD13xsyDHihBqb9AiVPsE_d8WPEKTLuUcv2xdjK8qzLM1PdUDlqPAHH-eeL99vvNC4cFKsrFZ9QuCGmjL
```

:::note
The "Share" button has a gear icon that let's you select "Long URL"
that produces these URLs. The encoded share links can be used without the
central session sharing system in place, as the entire session is encoded in
the URL.
:::
